{"version":3,"sources":["kratosr.js"],"names":["_regenerator","e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","this","setPrototypeOf","__proto__","displayName","w","m","defineProperty","enumerable","configurable","writable","_invoke","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","window","requestIdleCallback","handler","startTime","Date","now","setTimeout","didTimeout","timeRemaining","Math","max","cancelIdleCallback","id","clearTimeout","copyCode","triggerBtn","targetCodeID","targetCodeElement","document","getElementById","code","innerText","navigator","clipboard","writeText","origInner","innerHTML","copyrightString","loadConfig","_ref","_callee","_window$kr","url","_context","kr","siteRoot","fetch","json","docTitle","getTimeString","msec","tString","exact","undefined","sec","dnum","floor","hnum","mnum","snum","dstr","toString","hstr","mstr","sstr","makeDelay","callback","ms","timer","context","args","initPerPage","sidebarTocWidget","initFunc","tocDOMs","getElementsByClassName","tocItems","Array","from","forEach","tocItem","linkItem","querySelector","titleText","decodeURI","getAttribute","substring","Error","titleElem","setAttribute","push","at","el","console","log","message","classList","add","curTocId","tocActivate","newId","remove","nCur","contains","parentNode","applyDecision","pos","scrollY","requestAnimationFrame","observer","IntersectionObserver","entries","decision","entry","currentIndex","Number","parseInt","target","isIntersecting","boundingClientRect","top","rootBounds","bottom","height","intersectionRatio","rootMargin","threshold","x","observe","addEventListener","disconnect","once","tocUpdatePos","h","getBoundingClientRect","tocGetId","newPos","isInteger","nowY","tocOnScroll","tocOnResize","removeEventListener","readProgBar","articleElem","setPercent","currentTop","documentElement","scrollTop","docHeight","clientHeight","winHeight","headerHeight","offsetTop","contentMath","scrollHeight","scrollPercent","min","scrollPercentRound","round","style","width","offsetParent","title","querySelectorAll","figure","count","getElementsByTagName","concat","$","fancybox","defaults","hash","each","find","parent","hasClass","is","alt","after","wrap","src","runningOnBrowser","isBot","test","userAgent","supportsIntersectionObserver","commsArea","loadwork","loadCommentsEventHandler","load_comm","commentsLazyLoad","initPerPageWithConfig","imageboxs","randomAmount","cover","baseUrl","coverFileNameTemplate","filenameTemplate","usedCovers","generateNewCoverID","coverNo","remailFailCounts","random","len","attr","coverFileName","replace","coverUrl","includes","loadRandomCover","copyrightNotice","location","href","setCopyright","expire_day","expireAlert","dateTimeTag","updateDateTime","gap","expireNotify","themeInit","isScrolledDown","pageScrollDownClass","$clone","body","oncopy","copiedContent","getSelection","preventDefault","clipboardData","setData","copyEventInit","siteLeaveEvent","titleTime","OriginLogo","hidden","leaveTitle","leaveLogo","returnTitle","leaveEventInit","createTime","upTimeNode","setInterval","initTime","on","layer","open","type","area","donateBtn","resize","scrollbar","content","scanNotice","qr_alipay","qr_wechat","click","removeClass","addClass","donateConfig","topNavScrollToggle","lastHeight","innerHeight","isTopNavHidden","topNavScrollToggleInit","event","animate","offset","clone","prepend","css","container","has","next","slideToggle","fadeToggle","MathJax","Hub","Typeset","readyState"],"mappings":"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","file":"../js/kratosr.min.js","sourcesContent":["/**\n * 因为后台任务API还是相当新的，而你的代码可能需要在那些仍不支持此API的浏览器上运行。\n * 你可以把 setTimeout() 用作回调选项来做这样的事。\n * 这个并不是 polyfill ，因为它在功能上并不相同； \n * setTimeout() 并不会让你利用空闲时段，而是使你的代码在情况允许时执行你的代码，\n * 以使我们可以尽可能地避免造成用户体验性能表现延迟的后果。\n */\n// https://developer.mozilla.org/zh-CN/docs/Web/API/Background_Tasks_API \nwindow.requestIdleCallback = window.requestIdleCallback || function(handler) {\n    let startTime = Date.now();\n    return setTimeout(function() {\n      handler({\n        didTimeout: false,\n        timeRemaining: function() {\n          return Math.max(0, 50.0 - (Date.now() - startTime));\n        }\n      });\n    }, 1);\n};\n\nwindow.cancelIdleCallback = window.cancelIdleCallback || function(id) {\n    clearTimeout(id);\n};\n\n/**\n * 一些暴露给 DOM 交互使用的全局函数\n */\n\nwindow.copyCode = window.copyCode || function(triggerBtn, targetCodeID) {\n    // 用了 navigator.clipboard API ，不要再用老依赖和写法了\n    // https://developer.mozilla.org/en-US/docs/Web/API/Navigator/clipboard\n    const targetCodeElement = document.getElementById(targetCodeID);\n    if (targetCodeElement) {\n        const code = targetCodeElement.innerText;\n        navigator.clipboard.writeText(code);\n\n        // 复制成功，庆祝一下\n        const origInner = triggerBtn.innerHTML;\n        triggerBtn.innerHTML = `<i class=\"fa fa-check-circle\"></i>&nbsp;成功~`;\n        setTimeout(() => {\n            triggerBtn.innerHTML = origInner;\n        }, 3000);\n    }\n    // 并且这样复制不会触发 CC 提示，就不用担心代码被提示弄出一堆错了\n};\n\n/**\n * 核心的配置体，包一层防止全局变量命名导致的冲突\n */\n\n(()=>{\n    const loadConfig = async () => {\n        var url = (window.kr?.siteRoot || '/') + 'config/main.json';\n        return await (await fetch(url)).json()\n    };\n    const pageScrollDownInit = ()=>{\n        let isScrolledDown = false;\n        const pageScrollDownClass = () => {\n            window.requestAnimationFrame(() => {\n                if (window.scrollY > 200){\n                    if (!isScrolledDown) {\n                        document.body.classList.add('scroll-down');\n                        isScrolledDown = true;\n                    }\n                } else {\n                    if (isScrolledDown) {\n                        document.body.classList.remove('scroll-down');\n                        isScrolledDown = false;\n                    }\n                }\n            });\n        };\n        $('.gotop-box').on('click',function(event){\n            // event.preventDefault();\n            $('html, body').animate({\n                scrollTop:$('html').offset().top\n            },500);\n            return false;\n        });\n        pageScrollDownClass();\n        window.addEventListener('scroll', pageScrollDownClass);\n    };\n    const offcanvas = ()=>{\n        let $clone = $('#kratos-menu-wrap').clone();\n        $clone.attr({\n            'id':'offcanvas-menu'\n        });\n        $clone.find('> ul').attr({\n            'id':''\n        }).addClass('ul-me');\n        $('#kratos-page').prepend($clone);\n        $('.js-kratos-nav-toggle').on('click',()=>{\n            if($('.nav-toggle').hasClass('toon')){\n                $('.nav-toggle').removeClass('toon');\n                $('#offcanvas-menu').css('right','-240px');\n            }else{\n                $('.nav-toggle').addClass('toon');\n                $('#offcanvas-menu').css('right','0px');\n            }\n        });\n        $('#offcanvas-menu').css('height',$(window).height());\n        $('#offcanvas-menu').css('right','-240px');\n        $(window).resize(()=>{\n            const w = $(window);\n            $('#offcanvas-menu').css('height',w.height());\n            if(w.width()>769){\n                if($('.nav-toggle').hasClass('toon')){\n                    $('.nav-toggle').removeClass('toon');\n                    $('#offcanvas-menu').css('right','-240px');\n                }\n            }\n        });\n    };\n    const mobiClick = ()=>{\n        $(document).click((e)=>{\n            const container = $(\"#offcanvas-menu,.js-kratos-nav-toggle\");\n            if (!container.is(e.target) && container.has(e.target).length === 0) {\n                if ($('.nav-toggle').hasClass('toon')) {\n                    $('.nav-toggle').removeClass('toon');\n                    $('#offcanvas-menu').css('right','-240px');\n                }\n            }\n        });\n    };\n    const xControl = ()=>{\n        $(document).on(\"click\",\".xHeading\", function(event){\n            $(this).next().slideToggle(300);\n            if ($(this).parent('.xControl').hasClass('active')) {\n                $(this).parent('.xControl').removeClass('active');\n            } else {\n                $(this).parent('.xControl').addClass('active');\n            }\n            event.preventDefault();\n        });\n    };\n\n    const donateConfig = (kr)=>{\n        $(document).on(\"click\",\".donate\",()=>{\n            layer.open({\n                type:1,\n                area:['300px', '370px'],\n                title:kr.donateBtn,\n                resize:false,\n                scrollbar:false,\n                content:'<div class=\"donate-box\"><div class=\"meta-pay text-center\"><strong>'+kr.scanNotice+'</strong></div><div class=\"qr-pay text-center\"><img class=\"pay-img\" id=\"alipay_qr\" src=\"'+kr.qr_alipay+'\"><img class=\"pay-img d-none\" id=\"wechat_qr\" src=\"'+kr.qr_wechat+'\"></div><div class=\"choose-pay text-center mt-2\"><input id=\"alipay\" type=\"radio\" name=\"pay-method\" checked><label for=\"alipay\" class=\"pay-button\"><img src=\"/images/alipay.webp\"></label><input id=\"wechatpay\" type=\"radio\" name=\"pay-method\"><label for=\"wechatpay\" class=\"pay-button\"><img src=\"/images/wechat.webp\"></label></div></div>'\n            });\n            $(\".choose-pay input[type='radio']\").click(function(){\n                const id = $(this).attr(\"id\");\n                if (id == 'alipay') {\n                    $(\".qr-pay #alipay_qr\").removeClass('d-none');\n                    $(\".qr-pay #wechat_qr\").addClass('d-none');\n                }\n                if (id == 'wechatpay') {\n                    $(\".qr-pay #alipay_qr\").addClass('d-none');\n                    $(\".qr-pay #wechat_qr\").removeClass('d-none');\n                }\n            });\n        });\n    };\n\n    const shareMenu = ()=>{\n        $(document).on(\"click\",\".share\",()=>{$(\".share-wrap\").fadeToggle(\"slow\");});\n    };\n\n    const loadRandomCover = (kr)=>{\n        // 图片\n        const imageboxs = document.getElementsByClassName(\"kratos-entry-thumb-new-img\");\n        const randomAmount = kr.cover && kr.cover.randomAmount || 20;\n        const baseUrl = kr.cover && kr.cover.baseUrl || 'https://cdn.jsdelivr.net/npm/hexo-theme-kratos-rebirth@latest/source/images/thumb/'\n        const coverFileNameTemplate = kr.cover && kr.cover.filenameTemplate || \"thumb_{no}.webp\";\n        const usedCovers = new Array(randomAmount + 1);\n\n        const generateNewCoverID = () => {\n            let remailFailCounts = 5; // set max fail counts\n            let coverNo;\n            while (remailFailCounts > 0) {\n                // rand one\n                coverNo = Math.floor(Math.random() * randomAmount + 1);\n                if (!usedCovers[coverNo]) {\n                    // valid\n                    break;\n                } else {\n                    // fails\n                    remailFailCounts--;\n                }\n            }\n\n            if (remailFailCounts <= 0) {\n                // rand failed, find one manually\n                coverNo = -1;\n                for (let i = 1; i <= randomAmount; i++) {\n                    if (!usedCovers[i]) {\n                        // use first\n                        coverNo = i;\n                        break;\n                    }\n                }\n                if (coverNo === -1) {\n                    // All used\n                    // clear all\n                    for (let i = 1; i <= randomAmount; i++) {\n                        usedCovers[i] = false;\n                    }\n                    // rand one\n                    coverNo = Math.floor(Math.random() * randomAmount + 1);\n                }\n            }\n\n            // mark as used\n            usedCovers[coverNo] = true;\n            \n            // return\n            return coverNo;\n        }\n\n        for (let i = 0, len = imageboxs.length; i < len; i++) {\n            if (!($(imageboxs[i]).attr(\"src\"))) {\n                const coverNo = generateNewCoverID();\n                const coverFileName = coverFileNameTemplate.replace(\"{no}\", coverNo.toString());\n                let coverUrl;\n                if (coverFileName.includes(\"//\")) {\n                    coverUrl = coverFileName;\n                } else if (baseUrl.substring(baseUrl.length - 1) === \"/\") {\n                    coverUrl = baseUrl + coverFileName;\n                } else {\n                    coverUrl = baseUrl + '/' + coverFileName;\n                }\n                $(imageboxs[i]).attr(\"src\", coverUrl);\n            }\n        }\n    };\n\n    const fancyboxInit = ()=>{\n          if (typeof $.fancybox !== 'undefined'){\n            $.fancybox.defaults.hash = false;\n            $('.kratos-hentry').each(function(i){\n                $(this).find('img').each(function(){\n                  if ($(this).parent().hasClass('fancybox') || $(this).parent().hasClass('qrcode') || $(this).parent().is('a')) return;\n                  const alt = this.alt;\n                  if (alt) $(this).after('<span class=\"caption\">' + alt + '</span>');\n                  $(this).wrap('<a rel=\"gallery\" href=\"' + this.src + '\" data-fancybox=\\\"gallery\\\" data-caption=\"' + alt + '\"></a>')\n                });\n            });\n            $('.fancybox').fancybox();\n          }\n    };\n\n    const tocNavInit = ()=>{\n        $(document).on(\"click\", 'a[class=toc-link]', function(){\n            $('html, body').animate({\n                scrollTop:$(decodeURI($(this).attr(\"href\"))).offset().top - 60\n            },500);\n            return false;\n        });\n    };\n\n    let copyrightString;\n    const setCopyright = (kr)=>{\n        copyrightString = `\n\n-------------------------\n${kr.copyrightNotice}\n作者：${document.querySelector(\"meta[name='author']\").getAttribute('content')}\n来源：${document.title}\n链接：${window.location.href}\n`;\n    }\n\n    const copyEventInit = (kr)=>{\n        if (kr.copyrightNotice) {\n            document.body.oncopy = (e)=>{\n                if (copyrightString) {\n                    const copiedContent = window.getSelection().toString();\n                    if (copiedContent.length > 150) {\n                        e.preventDefault();\n                        if (e.clipboardData) {\n                            e.clipboardData.setData(\"text/plain\", copiedContent + copyrightString);\n                        }\n                    }\n                }\n            };\n        }\n    };\n\n    let docTitle = '';\n    const saveTitle = () => {\n        docTitle = document.title;\n    };\n\n    const leaveEventInit = (kr) => {\n        if (kr.siteLeaveEvent) {\n            let titleTime;\n            const OriginLogo = $('[rel=\"icon\"]').attr(\"href\");\n            document.addEventListener('visibilitychange', ()=>{\n                if (document.hidden) {\n                    document.title = kr.leaveTitle;\n                    if (kr.leaveLogo) {\n                        $('[rel=\"icon\"]').attr(\"href\", kr.leaveLogo);\n                    }\n                    clearTimeout(titleTime);\n                } else {\n                    document.title = kr.returnTitle + \" \" + docTitle;\n                    if (kr.leaveLogo) {\n                        $('[rel=\"icon\"]').attr(\"href\", OriginLogo);\n                    }\n                    titleTime = setTimeout(()=>{\n                        document.title = docTitle;\n                        titleTime = 0;\n                    }, 2000);\n                }\n            });\n        }\n    };\n\n    const getTimeString = (msec, exact = true) => {\n        let tString;\n        const sec = msec / 1000;\n        const dnum = Math.floor(sec / 60 / 60 / 24);\n        const hnum = Math.floor(sec / 60 / 60 - (24 * dnum));\n        const mnum = Math.floor(sec / 60 - (24 * 60 * dnum) - (60 * hnum));\n        const snum = Math.floor(sec - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum));\n        let dstr = dnum.toString();\n        let hstr = hnum.toString();\n        let mstr = mnum.toString();\n        let sstr = snum.toString();\n        if (exact) {\n            if (dstr && dstr.length === 1) {\n                dstr = '0' + dstr;\n            }\n            if (hstr && hstr.length === 1) {\n                hstr = '0' + hstr;\n            }\n            if (mstr && mstr.length === 1) {\n                mstr = '0' + mstr;\n            }\n            if (sstr && sstr.length === 1) {\n                sstr = '0' + sstr;\n            }\n            tString = dstr + \"天\" + hstr + \"小时\" + mstr + \"分\" + sstr + \"秒\";\n        } else {\n            // 大概值\n            if (dnum < 540) {\n                // 一年半内\n                if (dnum < 60) {\n                    // 两个月内\n                    tString = dstr + \"天\";\n                } else {\n                    // 年内月外\n                    tString = Math.floor(dnum / 30).toString() + '个月';\n                }\n            } else {\n                // 年外\n                tString = Math.floor(dnum / 365).toString() + '年';\n            }\n        }\n        return tString;\n    };\n\n    const initTime = (kr) => {\n        const createTime = new Date(kr.createTime);\n        const upTimeNode = document.getElementById(\"span_dt\");\n        setInterval(() => {\n            upTimeNode.innerText = getTimeString(Date.now() - createTime);\n        }, 1000);\n    };\n\n    const codeCopyInit = () => {\n        const codeFigures = document.querySelectorAll('figure.highlight');\n        codeFigures.forEach((figure, count) => {\n            figure\n                .getElementsByTagName('table')[0]\n                .getElementsByTagName('tbody')[0]\n                .getElementsByTagName('tr')[0]\n                .getElementsByClassName('code')[0]\n            .setAttribute('id', `code-${count}`);\n\n            figure.innerHTML += \n            `<button class=\"copy\" onclick=\"copyCode(this, 'code-${count}')\">\n                <i class=\"fa fa-copy\"></i>&nbsp;复制\n            </button>`;\n        });\n    };\n\n    const commentsLazyLoad = () => {\n        // 检查当前是否在浏览器中运行\n        const runningOnBrowser = typeof window !== \"undefined\";\n        // 通过检查 scroll 事件 API 和 User-Agent 来匹配爬虫\n        const isBot = runningOnBrowser && !(\"onscroll\" in window) || typeof navigator !== \"undefined\" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);\n        // 检查当前浏览器是否支持 IntersectionObserver API\n        const supportsIntersectionObserver = runningOnBrowser && \"IntersectionObserver\" in window;\n        // 需要懒加载的评论区块\n        const commsArea = document.querySelector('.post-comments.lazy-load');\n        // 加载评论的函数\n        const loadwork = () => {\n            if (window.loadCommentsEventHandler) {\n                // 取消上一个加载事件\n                window.cancelIdleCallback(window.loadCommentsEventHandler);\n            }\n            if (typeof load_comm === 'undefined' || load_comm === null) {\n                return;\n            }\n            // 加载新评论模块\n            window.loadCommentsEventHandler = window.requestIdleCallback(load_comm);\n            // 防止二次加载，清理掉函数\n            load_comm = null;\n        };\n        if (runningOnBrowser && !isBot && supportsIntersectionObserver && commsArea !== null) {\n            const observer = new IntersectionObserver((entries) => {\n                if (entries[0].isIntersecting) {\n                    loadwork();\n                    observer.disconnect();\n                }\n            }, { threshold: 0 });\n            observer.observe(commsArea);\n        } else {\n            loadwork();\n        }\n    };\n\n    const expireNotify = (kr) => {\n        if (kr.expire_day) {\n            const expireAlert = document.getElementById('expire-alert');\n            if (expireAlert) {\n                const dateTimeTag = expireAlert.querySelector('time');\n                const updateDateTime = new Date(parseInt(dateTimeTag.getAttribute('datetime')));\n                const nowDateTime = Date.now();\n                const gap = nowDateTime - updateDateTime;\n                if (gap > kr.expire_day * 24 * 3600 * 1000) {\n                    // 内容可能过期，需要提示\n                    dateTimeTag.innerText = getTimeString(gap, false);\n                    expireAlert.classList.remove('hidden');\n                }\n            }\n            \n        }\n    };\n\n    const makeDelay = (callback, ms) => {\n        var timer = 0;\n        return function () {\n            var context = this, args = arguments;\n            clearTimeout(timer);\n            timer = setTimeout(function () {\n                callback.apply(context, args);\n            }, ms || 0);\n        };\n    }\n\n    const tocWidgetAnimInit = () => {\n        const sidebarTocWidget = document.getElementById('krw-toc');\n        const initFunc = () => {\n            // 有toc的页面\n            // 获取侧边栏所有的toc项\n            const tocDOMs = sidebarTocWidget.getElementsByClassName('toc-item');\n            // 元素高度映射记录\n            const tocItems = [];\n            try {\n                Array.from(tocDOMs).forEach((tocItem) => {\n                    const linkItem = tocItem.querySelector('.toc-link');\n                    const titleText = decodeURI(linkItem.getAttribute('href'));\n                    if (titleText.substring(0, 1) != '#') {\n                        throw new Error('TOC 小标题链接无效，格式无限');\n                    }\n                    const titleElem = document.getElementById(titleText.substring(1));\n                    if (!titleElem) {\n                        throw new Error('TOC 小标题链接无效，未找到相关引用');\n                    }\n                    titleElem.setAttribute(\"data-toc-id\", tocItems.length)\n                    tocItems.push({\n                        at: titleElem,\n                        el: tocItem\n                    });\n                });\n            } catch (e) {\n                console.log('错误：', e.message);\n                Array.from(tocDOMs).forEach((tocItem) => {\n                    tocItem.classList.add('show');\n                });\n                return;\n            }\n\n            // 初始化为不存在的标题\n            let curTocId = -1;\n            // 标题激活状态修改函数\n            const tocActivate = (newId) => {\n                if (curTocId === newId) {\n                    // Do nothing...\n                    return;\n                }\n                if (curTocId !== -1) {\n                    // 清除旧标题激活状态\n                    tocItems[curTocId].el.classList.remove('active');\n                    tocItems[curTocId].el.classList.remove('show');\n                    // 清除旧元素层级展示状态\n                    let nCur = tocItems[curTocId].el\n                    while (!nCur.classList.contains('toc')) {\n                        if (nCur.classList.contains('toc-item')) {\n                            nCur.classList.remove('show');\n                        }\n                        nCur = nCur.parentNode;\n                    }\n                }\n                if (newId !== -1) {\n                    // 构建新标题激活状态\n                    tocItems[newId].el.classList.add('active');\n                    tocItems[newId].el.classList.add('show');\n                    // 建立新元素层级展示状态\n                    let nCur = tocItems[newId].el\n                    while (!nCur.classList.contains('toc')) {\n                        if (nCur.classList.contains('toc-item')) {\n                            nCur.classList.add('show');\n                        }\n                        nCur = nCur.parentNode;\n                    }\n                }\n                curTocId = newId;\n            };\n\n            if (\"IntersectionObserver\" in window) {\n                const applyDecision = makeDelay((i, pos) => {\n                    if (pos === window.scrollY) {\n                        window.requestAnimationFrame(() => {\n                            tocActivate(i);\n                        });\n                    } else {\n                        applyDecision(i, window.scrollY);\n                    }\n                }, 100)\n\n                const observer = new IntersectionObserver((entries) => {\n                    let decision = null\n                    entries.forEach((entry) => {\n                        const currentIndex = Number.parseInt(entry.target.getAttribute('data-toc-id'), 10);\n                        if (!entry.isIntersecting\n                            && entry.boundingClientRect.top <= entry.rootBounds.top) {\n                            decision = currentIndex\n                        } else if (entry.isIntersecting\n                            && entry.boundingClientRect.bottom < entry.rootBounds.top + entry.rootBounds.height / 2\n                            && entry.intersectionRatio === 1) {\n                            decision = currentIndex - 1\n                        }\n                    })\n                    if (decision !== null) {\n                        applyDecision(decision, window.scrollY);\n                    }\n                }, {\n                    rootMargin: '-62px 0px 0px 0px',\n                    threshold: 1.0,\n                })\n                tocItems.forEach((x) => {\n                    observer.observe(x.at)\n                });\n                window.addEventListener('pjax:before', () => {\n                    observer.disconnect();\n                    tocItems.length = 0; // 奇妙的数组清空方式\n                }, { once: true });\n            } else {\n                const tocUpdatePos = () => {\n                    tocItems.forEach((x) => {\n                        x.h = x.at.getBoundingClientRect().top + window.scrollY - 61 // 比 click 事件那里多减掉1，避免浏览器 round 后导致的判断失败\n                    });\n                };\n\n                tocUpdatePos();\n\n                // 标题定位函数\n                const tocGetId = () => {\n                    let newPos;\n                    if (!Number.isInteger(curTocId) || curTocId < 0 || curTocId > tocItems.length - 1) {\n                        newPos = 0;\n                    } else {\n                        newPos = curTocId;\n                    }\n                    const nowY = window.scrollY;\n                    if (nowY >= tocItems[newPos].h) {\n                        if (nowY >= tocItems[tocItems.length - 1].h) {\n                            newPos = tocItems.length - 1;\n                        } else {\n                            while (nowY >= tocItems[newPos + 1].h) {\n                                newPos++;\n                            }\n                        }\n                    } else {\n                        while (nowY < tocItems[newPos].h) {\n                            newPos--;\n                            if (newPos < 0) break;\n                        }\n                    }\n                    return newPos;\n                }\n\n                // 处理事件的函数\n                const tocOnScroll = makeDelay(() => {\n                    window.requestAnimationFrame(() => {\n                        tocActivate(tocGetId());\n                    });\n                }, 100);\n\n                const tocOnResize = makeDelay(() => {\n                    tocUpdatePos();\n                    window.requestAnimationFrame(() => {\n                        tocActivate(tocGetId());\n                    });\n                }, 100);\n\n                window.addEventListener(\"resize\", tocOnResize);\n                window.addEventListener('scroll', tocOnScroll);\n                // pjax前销毁\n                window.addEventListener('pjax:before', () => {\n                    window.removeEventListener('resize', tocOnResize);\n                    window.removeEventListener('scroll', tocOnScroll);\n                    tocItems.length = 0; // 奇妙的数组清空方式\n                }, { once: true });\n            }\n\n            // 阅读进度\n            const readProgBar = document.getElementsByClassName('toc-progress-bar')[0];\n            const articleElem = document.querySelector('.kratos-post-content');\n            const setPercent = () => {\n                // 参考 Butterfly 主题相关实现\n                // https://github.com/jerryc127/hexo-theme-butterfly/blob/c1ac4a5e167f7bb26287fc9ca32a182cfc293231/source/js/main.js#L337-L346\n                if (articleElem) {\n                    const currentTop = window.scrollY || document.documentElement.scrollTop\n                    const docHeight = articleElem.clientHeight\n                    const winHeight = document.documentElement.clientHeight\n                    const headerHeight = articleElem.offsetTop\n                    const contentMath =\n                        (docHeight > winHeight) ?\n                            (docHeight - winHeight) :\n                            (document.documentElement.scrollHeight - winHeight)\n                    const scrollPercent = Math.max(0, Math.min((currentTop - headerHeight) / (contentMath), 1))\n                    const scrollPercentRound = Math.round(scrollPercent * 100)\n                    readProgBar.style.width = (scrollPercent * 100).toString() + '%';\n                    readProgBar.setAttribute('aria-valuenow', scrollPercentRound);\n                }\n            }\n            window.addEventListener('scroll', () => {\n                window.requestAnimationFrame(setPercent);\n            });\n            setPercent(); // 初始运行一次\n        }\n        if (sidebarTocWidget) {\n            if (sidebarTocWidget.offsetParent !== null) {\n                initFunc();\n            } else if (\"IntersectionObserver\" in window) {\n                // Init when become visible\n                new IntersectionObserver(initFunc, {\n                    threshold: 0,\n                    once: true,\n                }).observe(sidebarTocWidget);\n            }\n        }\n    };\n\n    const topNavScrollToggleInit = (kr) => {\n        // 判断设置参数\n        if (!kr.topNavScrollToggle) {\n            return; // 没有启用\n        }\n        // 记录上一次滚动高度，用于判断滚动方向\n        let lastHeight = window.innerHeight;\n        // 记录顶部栏隐藏状态\n        let isTopNavHidden = false;\n\n        // 处理事件的函数\n        const handleTopNavScrollToggle = () => {\n            window.requestAnimationFrame(() => {\n                if (lastHeight < window.scrollY) {\n                    // 向下滚动\n                    if (!isTopNavHidden) {\n                        document.body.classList.add('nav-up');\n                        isTopNavHidden = true;\n                    }\n                } else if (lastHeight > window.scrollY) {\n                    // 向上滚动\n                    if (isTopNavHidden) {\n                        document.body.classList.remove('nav-up');\n                        isTopNavHidden = false;\n                    }\n                }\n                // 相等则不做处理\n                lastHeight = window.scrollY;\n            });\n        };\n\n        // 仅处理鼠标滚动\n        window.addEventListener('wheel', handleTopNavScrollToggle);\n\n    };\n\n    const initPerPage = () => {\n        tocWidgetAnimInit();\n        saveTitle();\n        codeCopyInit();\n        fancyboxInit();\n        commentsLazyLoad();\n    };\n\n    const initPerPageWithConfig = kr => {\n        loadRandomCover(kr);\n        setCopyright(kr);\n        expireNotify(kr);\n    };\n\n    window.addEventListener('pjax:complete', () => {\n        initPerPage();\n        if (typeof MathJax !== 'undefined') {\n            MathJax.Hub.Typeset();\n        }\n    });\n\n    function themeInit() {\n        document.removeEventListener(\"DOMContentLoaded\", themeInit, false);\n        window.removeEventListener(\"load\", themeInit, false);\n\n        loadConfig().then(kr => {\n            copyEventInit(kr);\n            leaveEventInit(kr);\n            initTime(kr);\n            donateConfig(kr);\n            topNavScrollToggleInit(kr);\n            initPerPageWithConfig(kr);\n            window.addEventListener('pjax:complete', () => {\n                initPerPageWithConfig(kr);\n            });\n        });\n        \n        pageScrollDownInit();\n        offcanvas();\n        mobiClick();\n        xControl();\n        shareMenu();\n        tocNavInit();\n        initPerPage();\n    }\n\n    if (document.readyState === \"complete\") {\n        setTimeout(themeInit);\n    } else {\n        document.addEventListener(\"DOMContentLoaded\", themeInit, false);\n        window.addEventListener(\"load\", themeInit, false); //fallback\n    }\n})();\n"]}