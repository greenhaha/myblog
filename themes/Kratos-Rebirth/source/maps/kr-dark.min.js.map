{"version":3,"sources":["kr-dark.js"],"names":["rootElement","document","documentElement","darkModeStorageKey","rootElementDarkModeAttributeName","darkModeTogglebuttonElement","getElementById","getLS","k","localStorage","getItem","e","getModeFromCSSMediaQuery","window","matchMedia","matches","resetRootDarkModeAttributeAndLS","removeAttribute","removeItem","removeLS","validColorModeKeys","dark","light","applyCustomDarkModeSettings","mode","currentSetting","setAttribute","invertDarkModeObj","toggleCustomDarkMode","v","setItem","setLS","addEventListener"],"mappings":"AAOA,MACI,MAAMA,EAAcC,SAASC,gBACvBC,EAAqB,oBACrBC,EAAmC,yBACnCC,EAA8BJ,SAASK,eAAe,mBAYtDC,EAASC,IACX,IACI,OAAOC,aAAaC,QAAQF,GAC9B,MAAOG,GACL,OAAO,OAITC,EAA2B,IACtBC,OAAOC,WAAW,gCAAgCC,QAAU,OAAS,QAE1EC,EAAkC,KACpChB,EAAYiB,gBAAgBb,GAjBf,CAACI,IACd,IACIC,aAAaS,WAAWV,GAC1B,MAAOG,MAeTQ,CAAShB,IAGPiB,EAAqB,CACvBC,MAAQ,EACRC,OAAS,GAGPC,EAA+BC,IAEjC,MAAMC,EAAiBD,GAAQjB,EAAMJ,GAEjCsB,IAAmBb,IAEnBI,IACOI,EAAmBK,GAC1BzB,EAAY0B,aAAatB,EAAkCqB,GAI3DT,KAIFW,EAAoB,CACtBN,KAAQ,QACRC,MAAS,QAGPM,EAAuB,KACzB,IAAIH,EAAiBlB,EAAMJ,GAE3B,GAAIiB,EAAmBK,GAEnBA,EAAiBE,EAAkBF,OAChC,CAAA,GAAuB,OAAnBA,EAMP,OAHAA,EAAiBE,EAAkBf,KAQvC,MArEU,EAACJ,EAAGqB,KACd,IACIpB,aAAaqB,QAAQtB,EAAGqB,GAC1B,MAAOlB,MAgEToB,CAAM5B,EAAoBsB,GAEnBA,GAIXF,IAEAlB,EAA4B2B,iBAAiB,SAAS,KAEtDT,EAA4BK,SAnFhC","file":"../js/kr-dark.min.js","sourcesContent":["/*\n * 该部分代码采用 CC BY-NC-SA 4.0 许可协议，著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。\n * 作者：Sukka\n * 来源：你好黑暗，我的老朋友 —— 为网站添加用户友好的深色模式支持 | Sukka's Blog\n * 链接：https://blog.skk.moe/post/hello-darkmode-my-old-friend/\n */\n\n(()=>{\n    const rootElement = document.documentElement; // <html>\n    const darkModeStorageKey = 'user-color-scheme'; // 作为 localStorage 的 key\n    const rootElementDarkModeAttributeName = 'data-user-color-scheme';\n    const darkModeTogglebuttonElement = document.getElementById('darkmode-switch');\n\n    const setLS = (k, v) => {\n        try {\n            localStorage.setItem(k, v);\n        } catch (e) { }\n    };\n    const removeLS = (k) => {\n        try {\n            localStorage.removeItem(k);\n        } catch (e) { }\n    };\n    const getLS = (k) => {\n        try {\n            return localStorage.getItem(k);\n        } catch (e) {\n            return null // 与 localStorage 中没有找到对应 key 的行为一致\n        }\n    };\n\n    const getModeFromCSSMediaQuery = () => {\n        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'\n    };\n    const resetRootDarkModeAttributeAndLS = () => {\n        rootElement.removeAttribute(rootElementDarkModeAttributeName);\n        removeLS(darkModeStorageKey);\n    };\n\n    const validColorModeKeys = {\n        'dark': true,\n        'light': true\n    };\n    \n    const applyCustomDarkModeSettings = (mode) => {\n        // 接受从「开关」处传来的模式，或者从 localStorage 读取\n        const currentSetting = mode || getLS(darkModeStorageKey);\n    \n        if (currentSetting === getModeFromCSSMediaQuery()) {\n            // 当用户自定义的显示模式和 prefers-color-scheme 相同时重置、恢复到自动模式\n            resetRootDarkModeAttributeAndLS();\n        } else if (validColorModeKeys[currentSetting]) { // 相比 Array#indexOf，这种写法 Uglify 后字节数更少\n            rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);\n        } else {\n            // 首次访问或从未使用过开关、localStorage 中没有存储的值，currentSetting 是 null\n            // 或者 localStorage 被篡改，currentSetting 不是合法值\n            resetRootDarkModeAttributeAndLS();\n        }\n    };\n\n    const invertDarkModeObj = {\n        'dark': 'light',\n        'light': 'dark'\n    };\n    \n    const toggleCustomDarkMode = () => {\n        let currentSetting = getLS(darkModeStorageKey);\n        \n        if (validColorModeKeys[currentSetting]) {\n            // 从 localStorage 中读取模式，并取相反的模式\n            currentSetting = invertDarkModeObj[currentSetting];\n        } else if (currentSetting === null) {\n            // localStorage 中没有相关值，或者 localStorage 抛了 Error\n            // 从 CSS 中读取当前 prefers-color-scheme 并取相反的模式\n            currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];\n        } else {\n            // 不知道出了什么幺蛾子，比如 localStorage 被篡改成非法值\n            return; // 直接 return;\n        }\n        // 将相反的模式写入 localStorage\n        setLS(darkModeStorageKey, currentSetting);\n    \n        return currentSetting;\n    };\n\n    // 当页面加载时，将显示模式设置为 localStorage 中自定义的值（如果有的话）\n    applyCustomDarkModeSettings();\n\n    darkModeTogglebuttonElement.addEventListener('click', () => {\n    // 当用户点击「开关」时，获得新的显示模式、写入 localStorage、并在页面上生效\n    applyCustomDarkModeSettings(toggleCustomDarkMode());\n    });\n})();\n"]}