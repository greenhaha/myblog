{"version":3,"sources":["pjax.js"],"names":["$","mainElement","theTop","notMobile","offset","top","window","addEventListener","e","state","document","title","animate","scrollTop","content","ajax","url","html","OriginTitile","dispatchEvent","pjaxEvents","complete","before","Event","success","error","reqUrl","needPushState","isSuccessRequest","beforeSend","load_comm","NProgress","start","data","textStatus","jqXHR","find","responseText","history","replaceState","location","href","newTitle","filter","text","newContent","pushState","reqId","match","open","done","timeout","errorThrown","console","on","this","attr","includes","decodeURI"],"mappings":"AAAAA,GAAE,WACE,MAAMC,EAAc,yBACpBC,OAASC,UAAYH,EAAE,qBAAqBI,SAASC,IAAI,GAAK,EAgB9DC,OAAOC,iBAAiB,YAdCC,IAChBA,EAAEC,QACHC,SAASC,MAAQH,EAAEC,MAAME,OAASD,SAASC,MAC3CX,EAAE,aAAaY,QAAQ,CAACC,UAAUX,QAAS,UACZ,IAApBM,EAAEC,MAAMK,QACfC,EAAKP,EAAEC,MAAMO,KAAK,GAElBhB,EAAEC,GAAagB,KAAMT,EAAEC,MAAMK,SAGjCI,aAAeR,SAASC,MACxBL,OAAOa,cAAcC,EAAWC,cAKxC,MAAMD,EAAa,CACfE,OAAU,IAAIC,MAAM,eACpBC,QAAU,IAAID,MAAM,gBACpBF,SAAU,IAAIE,MAAM,iBACpBE,MAAU,IAAIF,MAAM,eAGxB,SAASR,EAAKW,EAAQC,GAElB,IAAIC,GAAmB,EAEvB5B,EAAEe,KAAK,CACHC,IAAKU,EACLG,WAAY,WAGiB,oBAAdC,WAA2C,OAAdA,YACpCA,UAAY,MAIhB9B,EAAE,aAAaY,QAAQ,CAACC,UAAUX,QAAS,KAG3C6B,UAAUC,QAEV1B,OAAOa,cAAcC,EAAWE,SAEpCE,QAAS,SAASS,EAAMC,EAAYC,QAEgB,IAArCnC,EAAEiC,GAAMG,KAAKnC,GAAagB,SAEjCW,GAAmB,GAGvBtB,OAAOa,cAAcC,EAAWI,UAEpCH,SAAU,SAASc,EAAOD,GAEtB,GAAIN,EAAkB,CAClB,MAAMK,EAAOE,EAAME,aAGnBC,QAAQC,aAAa,CACjBvB,IAAKwB,SAASC,KACd9B,MAAOD,SAASC,MAChBG,QAASd,EAAEU,UAAU0B,KAAKnC,GAAagB,QACxCP,SAASC,MAAO6B,SAASC,MAG5B,MAAMC,EAAW1C,EAAEiC,GAAMU,OAAO,SAASC,OACnCC,EAAa7C,EAAEiC,GAAMG,KAAKnC,GAAagB,OAGzCU,GAEArB,OAAOgC,QAAQQ,UAAU,CACrB9B,IAAKU,EACLf,MAAO+B,EACP5B,QAAS+B,GACVH,EAAUhB,GAIjBhB,SAASC,MAAQ+B,EACjB1C,EAAEC,GAAagB,KAAK4B,GAGpB3B,aAAeR,SAASC,MAGxB,MAAMoC,EAAQrB,EAAOsB,MAAM,SACvBD,GACA/C,EAAE,aAAaY,QAAQ,CAACC,UAAUb,EAAE+C,EAAM,IAAI3C,SAASC,IAAM,IAAK,UAKtEC,OAAO2C,KAAKvB,GAIhBK,UAAUmB,OAEV5C,OAAOa,cAAcC,EAAWC,WAEpC8B,QAAS,IACT1B,MAAO,SAASU,EAAOD,EAAYkB,GAE/BC,QAAQ5B,MAAM2B,GAEdZ,SAASC,KAAOf,EAEhBpB,OAAOa,cAAcC,EAAWK,UAI5CzB,EAAEU,UAAU4C,GAAG,QAAS,oDAAoD,WACxE,MAAM5B,EAAS1B,EAAEuD,MAAMC,KAAK,QAC5B,YAAsB,IAAX9B,MACFA,EAAO+B,SAAU,iBACrB1C,EAAK2C,UAAUhC,IAAS,IACtB","file":"../js/pjax.min.js","sourcesContent":["$(function() {\n    const mainElement = '#kratos-blog-post .row';\n    theTop = notMobile ? $(\"#kratos-blog-post\").offset().top-40 : 0;\n\n    const popStateHandler = (e) => {\n        if ( e.state ) {\n            document.title = e.state.title || document.title;\n            $(\"body,html\").animate({scrollTop:theTop}, 600);\n            if (typeof e.state.content === 'undefined') {\n                ajax(e.state.url, false);\n            } else {\n                $(mainElement).html( e.state.content );\n            }\n            // 更新外域变量\n            OriginTitile = document.title;\n            window.dispatchEvent(pjaxEvents.complete);\n        }\n    };\n    window.addEventListener('popstate', popStateHandler);\n\n    const pjaxEvents = {\n        before:   new Event('pjax:before')  ,\n        success:  new Event('pjax:success') ,\n        complete: new Event('pjax:complete'),\n        error:    new Event('pjax:error')   ,\n    };\n\n    function ajax(reqUrl, needPushState) {\n\n        let isSuccessRequest = false;\n\n        $.ajax({\n            url: reqUrl,\n            beforeSend: function () {\n\n                // 防止评论区再被加载，重置加载函数\n                if (typeof load_comm !== 'undefined' && load_comm !== null) {\n                    load_comm = null;\n                }\n\n                // 运动到顶部\n                $(\"body,html\").animate({scrollTop:theTop}, 600);\n\n                // 进度条开始\n                NProgress.start();\n                \n                window.dispatchEvent(pjaxEvents.before);\n            },\n            success: function(data, textStatus, jqXHR) {\n                \n                if (typeof $(data).find(mainElement).html() !== 'undefined') {\n                    // 这样才成功嘛\n                    isSuccessRequest = true;\n                }\n\n                window.dispatchEvent(pjaxEvents.success);\n            },\n            complete: function(jqXHR, textStatus) {\n\n                if (isSuccessRequest) {\n                    const data = jqXHR.responseText;\n\n                    // 替换记录的当前状态\n                    history.replaceState({\n                        url: location.href,\n                        title: document.title,\n                        content: $(document).find(mainElement).html(),\n                    }, document.title, location.href);\n\n                    // 记录新状态的一些信息\n                    const newTitle = $(data).filter(\"title\").text();\n                    const newContent = $(data).find(mainElement).html();\n\n                    // 如果需要压入新的状态\n                    if (needPushState) {\n                        // 压入新的状态\n                        window.history.pushState({\n                            url: reqUrl,\n                            title: newTitle,\n                            content: newContent,\n                        }, newTitle, reqUrl);\n                    }\n\n                    // 更新当前页面需要更新的内容\n                    document.title = newTitle;\n                    $(mainElement).html(newContent);\n\n                    // 更新外域变量\n                    OriginTitile = document.title;\n                    \n                    // 如果URL里有指定节点ID，则滚动到相应的节点位置\n                    const reqId = reqUrl.match(/\\#.+$/);\n                    if (reqId) {\n                        $(\"body,html\").animate({scrollTop:$(reqId[0]).offset().top - 40}, 600);\n                    }\n                } else {\n                    // 其实是失败的\n                    // 不如打开一个新页面？\n                    window.open(reqUrl);\n                }\n\n                // 进度条结束\n                NProgress.done();\n\n                window.dispatchEvent(pjaxEvents.complete);\n            },\n            timeout: 6000,\n            error: function(jqXHR, textStatus, errorThrown) {\n\n                console.error(errorThrown);\n\n                location.href = reqUrl;\n                \n                window.dispatchEvent(pjaxEvents.error);\n            }\n        });\n    }\n    $(document).on(\"click\", 'a[target!=_blank][rel!=gallery][class!=toc-link]', function() {\n        const reqUrl = $(this).attr(\"href\");\n        if (typeof reqUrl === 'undefined') return true;\n        else if (reqUrl.includes( \"javascript:\")) return true;\n        else ajax(decodeURI(reqUrl), true);\n        return false;\n    });\n});\n"]}